<!DOCTYPE html>

<head>
    <meta charset="utf-8">
    <title>Garden Game</title>
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/jspsych.js"></script>
    <script src="plugins/jspsych-resize.js"></script>
    <script src="plugins/jspsych-html-keyboard-response.js"></script>
    <script src="plugins/jspsych-image-keyboard-response.js"></script>
    <script src="plugins/jspsych-instructions.js"></script>
    <script src="plugins/jspsych-survey-text.js"></script>
    <script src="plugins/jspsych-survey-multi-choice.js"></script>
    <script src="plugins/jspsych-fullscreen.js"></script>
    <script src="plugins/jspsych-html-button-response.js"></script>
    <script src="plugins/jspsych-html-slider-response.js"></script>
    <script src="plugins/jspsych-categorize-html.js"></script>
    <script src="plugins/jspsych-fullscreen.js"></script>
    <script src="plugins/jsPsychHtmlButtonResponse.js"></script>    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <link href="css/my_exp.css" rel="stylesheet" type="text/css">
    <link href="css/jspsych.css" rel="stylesheet" type="text/css">
    
</head>


<body>

    <script>

        /*this defines the css properties according to the window_screen_size*/
        var root = document.documentElement;
        var vis_angle_px = 105
        //---------------------------------------------------------------------------------------------
        root.style.setProperty('--left_card', window.screen.width / 2 - 2 * vis_angle_px -10 + "px");
        root.style.setProperty('--right_card', window.screen.width / 2 - 2 * vis_angle_px -10 + "px");
        //root.style.setProperty('--top_card', window.screen.height / 2 - 130 + "px");
        root.style.setProperty('--top_card', window.screen.height / 2 - 120 + "px");
        root.style.setProperty('--top_card_reward', window.screen.height / 2 - 120 + "px");
        root.style.setProperty('--top_reward', window.screen.height / 2 + "px");
        root.style.setProperty('--left_reward', window.screen.width / 2 + "px");

        /*---------------------------------------------------- 
        Card game starts
        ------------------------------------------------------*/

        /*---------------------------------------------------- 
        Define images
        ------------------------------------------------------*/
        if (localStorage.mapping != undefined) { //are we debugging?
            var mapping = localStorage.mapping;
        }
        else {
            var mapping = 'sk'
        }
        // var mapping = localStorage.mapping;
        
        var practice_deck_images = ['images/flowers set 1_example/1.png', 'images/flowers set 1_example/2.png', 'images/flowers set 1_example/3.png', 'images/flowers set 1_example/4.png']
        var practice_deck_images_iti = ['images/flowers set 2_example/1.png', 'images/flowers set 2_example/2.png', 'images/flowers set 2_example/3.png', 'images/flowers set 2_example/4.png']
        var set2 = ['images/flowers set 2/1.png', 'images/flowers set 2/2.png', 'images/flowers set 2/3.png', 'images/flowers set 2/4.png']
        var set3 = ['images/flowers set 3/1.png', 'images/flowers set 3/2.png', 'images/flowers set 3/3.png', 'images/flowers set 3/4.png']
        var set4 = ['images/flowers set 4/1.png', 'images/flowers set 4/2.png', 'images/flowers set 4/3.png', 'images/flowers set 4/4.png']
        var set5 = ['images/flowers set 5/1.png', 'images/flowers set 5/2.png', 'images/flowers set 5/3.png', 'images/flowers set 5/4.png']
        var set6 = ['images/flowers set 6/1.png', 'images/flowers set 6/2.png', 'images/flowers set 6/3.png', 'images/flowers set 6/4.png']
        var set7 = ['images/flowers set 7/1.png', 'images/flowers set 7/2.png', 'images/flowers set 7/3.png', 'images/flowers set 7/4.png']
        var set8 = ['images/flowers set 8/1.png', 'images/flowers set 8/2.png', 'images/flowers set 8/3.png', 'images/flowers set 8/4.png']
        var set9 = ['images/flowers set 9/1.png', 'images/flowers set 9/2.png', 'images/flowers set 9/3.png', 'images/flowers set 9/4.png']
        var test_deck_images = [set2,set3,set4,set5,set6,set7,set8,set9]
        var test_deck_images_shuffle = jsPsych.randomization.sampleWithoutReplacement (test_deck_images,8)
        var reward_images = ['images/zero_coins.png', 'images/won1-no-back.png']
        var fixation = '<div style="font-size:60px;">+</div>'
        var square_left = '<div class="square_left"></div>'
        var square_right = '<div class="square_right"></div>'
        var Hourglass =['images/hourglass.png']
        var garden =['images/garden.png']
        var cute_gardener = ['images/cute_gardener.jpg']
        var number_of_reward1 
        var bonus
        var bonus_string 
        var accuracy

        /*---------------------------------------------------- 
        Start instructions
        ------------------------------------------------------*/
        var subject_num = {
            type: 'survey-text',
            questions: [
                {prompt: "אנא הכנס מספר נבדק", name: 'subject_num'}, 
                ]
            };
        
        
        var instructions_cards = {
            on_start: function () {
                if (document.querySelector('#cursor-toggle') != null) {
                    document.querySelector('#cursor-toggle').remove()
                }
            },
            type: "instructions",
            pages: ["<p><b>ברוכים הבאים למשחק הגינה </b></p>"
                + "<p style='text-align:right'>.הצלחה במשחק יכולה לזכות אתכם בבונוס"
                + "<p style='text-align:right'>.אם לא תזכו בכסף נוסף עדיין תקבלו את הקרדיט / התשלום שהובטח לכם עבור השלמת הניסוי"
                + "<p> <b> .אם תאסוף מספיק מטבעות תוכל לזכות בבונוס כספי</b> </p>"
                + "<br> <img class='garden' src='images/garden.png'>",


                "<p style='text-align:right'> .כעת נציג את ההוראות עבור משחק הגינה. אנא קראו אותם היטב <br>"
                + ".אתם יכולים לחזור באופן חופשי קדימה ואחורה בין מסכי ההוראות</p> "
                + "<p style='text-align:left'>.לאחר שתקראו את ההוראות <b>נבקש ממכם למלא מבדק קצר, </b>על מנת לוודא שהכל מובן היטב</p>",

                "<p style='text-align:right'> .במשחק זה, אתם הגננים של הגינה ומטרתכם היא לגדל כמה שיותר פרחים <p>"
                + "<p style='text-align:right'>.בכל פעם, עלייך לבחור פרח ולאחר הבחירה עלייך לחכות ולראות האם הפרח גדל<br> "
                + ".חלק מהפרחים יהיו מסוגלים לצמוח וחלקם לא<br> "
                + ".עבור כל פרח שצומח אתה תזכה במטבע. עבור כל פרח שלא מצליח לצמוח, לא תקבל מטבע<p>"
                +"<p style='text-align:right'.חלק מהפרחים טובים יותר מאחרים – ההסתברות שלהם לצמוח גבוהה יותר. עלייך למצוא אילו מהפרחים טובים יותר ולבחור בהם<br> "
                + ":המטרה שלך היא לאסוף כמה שיותר מטבעות, והבונוס שלך יחושב בהתאם</p> "
                + ".עבור כל 10 נבדקים בניסוי, הנבדק שיאסוף הכי הרבה מטבעות יקבל בונוס של 20 שקלים</p> "
                + "<br> <img class='cute_gardener' src='images/cute_gardener.jpg'>",            

                "<p style='text-align:right'> :להלן דוגמה של ארבעה פרחים </p>" +
                "<img class='group' src='images/flowers set 1_example/group.png' >",


                "<p>.בכל פעם, יוצגו על המסך רק שני פרחים מתוך ה- 4 האפשריים (כמו שניתן לראות בדוגמה)<br>.בכל פעם עליך לבחור אחד מבין שני הפרחים<br>.s במקלדת ,אם ברצונך לבחור בפרח השמאלי עלייך להקיש על k אם ברצונך לבחור בפרח הימני, עלייך להקיש על"
                + " <br><br><u>.אנא בצע את הבחירה מדויק ומהר ככל שאתה יכול</u><br><br>"
                + "<img class='example' src='images/flowers set 1_example/example.png' >"
                + "<p> <img class='keyboard' src='images/keyboard.png' ><p>",
                    
                "<p style='text-align:right'> .לאחר שבחרת פרח, אתה תראה את הבחירה שלך מסומנת על המסך <br>" 
                +" .(במקלדת s מקש) כמו שניתן לראות בדוגמה, התבצעה בחירה עבור הפרח השמאלי<p>"
                + "<br> <img class='selection_example' src='images/flowers set 1_example/selection_example.png''>" ,


                "<p style='text-align:right'>.לאחר הבחירה, אתה תראה את התוצאה שהתקבלה במרכז המסך. בדוגמה הנוכחית הפרח שנבחר אכן צמח - כלומר, זכייה במטבע אחד<br>"
                + "<b>.הזכייה במטבעות תלויה בפרחים אותם תבחר, חלק מהפרחים טובים יותר מאחרים</b><br>"
                    + ".המטרה שלך היא לגלות אילו פרחים טובים יותר מאחרים, ואותם לבחור</p>"
                + "<br> <img class='example' src='images/flowers set 1_example/reward_example.png'>",

                
                "<p style='text-align:right'> .במהלך המשחק, מידי פעם יופיע שעון חול על המסך, שעון החול יופיע למספר שניות ולאחר מכן יעלם. בזמן ששעון החול מופיע עליך להמתין <br>"
                +".זמן ההמתנה יכול להשתנות מפעם לפעם <b> והוא משתנה באופן אקראי </b> בין 0-8 שניות<br>"
                +".בזמן שאתה מחכה, עלייך <b> להישאר מפוקס </b>במבטך ובקשב שלך אל שעון החול שנמצא במרכז המסך <br>"
                +"<p>.<b>שים לב</b>: חשוב מאוד למען המהלך התקין של הניסוי שבעת ההמתנה תשמור על העיניים שלך מפוקסות אל שעון החול שבמרכז המסך ולא תעשה שום דבר מלבד לחכות</p>"
                +"<br> <img class='Hourglass' src='images/hourglass.png''> ",

                "<p style='text-align:right'><u>:שלושה דברים חשובים לזכור</u><br>"
             + ".א. רק הפרחים עצמם משפיעים על הזכייה במטבעות <b>המקשים על המקלדת בהם תמשתש על מנת לבחור בפרחים לא משפיעים על הסיכוי לזכות במטבעות</b>"
             + "<br>.ב. זמן ההמתנה לא משפיע על הסיכוי לזכות במטבעות</b>"
             + "<br>.ג. זמן המתנה משתנה באופן אקראי מפעם לפעם, מה שאומר <b>שאין פרחים שיש להם זמן המתנה ארוך יותר או קצר יותר</b></p>"],
            show_clickable_nav: true,
            button_label_next: 'המשך',
            button_label_previous: 'חזור'
        };

        var start_instructions_test = {
            on_start: function () {
                if (document.querySelector('#cursor-toggle') != null) {
                    document.querySelector('#cursor-toggle').remove()
                }
            },
            
            type: 'html-keyboard-response',
            stimulus: "<p> <br><br> .כעת נעבור למבדק קצר על מנת לוודא שהכל מובן. אם לא תענה נכונה על כל השאלות, תאלץ לחזור על ההוראות פעם נוספת <br><br> <b>לחץ על מקש כלשהו על מנת להמשיך</b></p>"
        }
        var Q1_2_options = ["2", "4", "6"];
        var Q3_options = ["עלי ללחוץ על הפרח", "עלי ללחוץ על החץ הימני או השמאלי במקלדת", "עלי ללחוץ על המקש המתאים במקלדת"];
        var Q4_5_6_7_options = ["נכון", "לא נכון"];
        var Q8_options = ["נכון, גם הפרחים וגם המקשים במקלדת משפיעים על הזכייה במטבע", "לא נכון, רק הפרחים משפיעים על הזכייה במטבע"];

        var instructions_test = {
            type: 'survey-multi-choice',
            button_label: 'המשך',
            questions: [
                { prompt: "?כמה סוגים שונים (בסך הכל) של פרחים קיימים בכל סיבוב", name: 'deck_size', correct: '4', options: Q1_2_options, required: true },
                { prompt: "?כמה פרחים מוצגים על המסך בכל צעד", name: 'cards_step', correct: '2', options: Q1_2_options, required: true },
                { prompt: "?איך אתה בוחר פרח", name: 'choose_card', correct: 'עלי ללחוץ על המקש המתאים במקלדת', options: Q3_options, required: true },
                { prompt: "זמן ההמתנה שמופיע עבור שעון החול הוא קבוע", name: 'waiting_time', correct: 'לא נכון', options: Q4_5_6_7_options, required: true },
                { prompt: "חלק מהפרחים טובים יותר מאחרים", name: 'better_cards', correct: 'נכון', options: Q4_5_6_7_options, required: true },
                { prompt: "אם זמן ההמתנה לפני או אחרי בחירה בפרח מסוים היה ארוך, סיכוי טוב יותר שאזכה במטבע", name: 'value_change', correct: 'לא נכון', options: Q4_5_6_7_options, required: true },
                { prompt: "בזמן ההמתנה עד לקבלת התוצאה, עלי להישאר מפוקס עם המבט על שעון החול", name: 'focused', correct: 'נכון', options: Q4_5_6_7_options, required: true },
                { prompt: "זכייה במטבע מושפעת מהאם השתמשתי במקש השמאלי או הימני במקלדת", name: 'location_value', correct: 'לא נכון, רק הפרחים משפיעים על הזכייה במטבע', options: Q8_options, required: true }
            ],
        };

        var if_trial = {
            type: 'html-button-response',
            stimulus: "<p>.מצטערים, ביצעת טעות<br>"
                + " .יש לחזור שוב על ההוראות"
                + ".אנא קרא את ההוראות והשאלות היטב לפני שאתה מגיש את התשובות<br>"
                + "!תודה",
            choices: ['בחזרה אל ההוראות']
        }
        var to_repeat;
        var check_answers = {
            timeline: [if_trial],
            conditional_function: function () {
                // get the data from the previous trial,
                // and check which key was pressed
                to_repeat = false;
                var responses_to_test = JSON.parse(jsPsych.data.get().filter({ trial_type: 'survey-multi-choice' }).last(1).select('responses').values[0])
                for (i = 0; i < instructions_test.questions.length; i++) {
                    current_name = instructions_test.questions[i].name;
                    current_correct = instructions_test.questions[i].correct
                    if (current_correct != responses_to_test[current_name]) {
                        to_repeat = true;
                        return to_repeat
                    }
                    else {
                        to_repeat = false;

                    }
                }
                return to_repeat
            }
        }
        /*---------------------------------------------------- 
        Functions for card game
        ------------------------------------------------------*/

        function get_locations(locations_arr, number_of_images, locations_arr1) {
            random_locations = [];
            if (number_of_images == 1) {
                return jsPsych.randomization.sampleWithoutReplacement(locations_arr1, 1)
            }
            for (var i = 0; i < 4; i++) {
                random_2_locations = jsPsych.randomization.sampleWithoutReplacement(locations_arr.slice(i * 3, i * 3 + 3), 2)
                random_locations.push(random_2_locations[0])
                if (number_of_images > 4) {
                    random_locations.push(random_2_locations[1])
                }
            }
            return random_locations
        }


        function draw_show_cards(deck) {
            drawn_cards = jsPsych.randomization.sampleWithoutReplacement(deck, 4)
            left_card = drawn_cards[0];
            right_card = drawn_cards[1];
            left_with_tag = "<img class='card_left' src='" + left_card  + "'>"
            right_with_tag = "<img class='card_right' src='" + right_card + "'>"
            return left_with_tag + right_with_tag + fixation;
        }

        function show_choice() {

            last_choice = jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(jsPsych.data.getLastTrialData().values()[0].key_press)
            if (last_choice == 's') {
                selected = 0
                card_to_show = "<img class='card_left_with_frame' src='" + left_card + "'>" + "<img class='card_right' src='" + right_card + "'>" 
            }
            else if (last_choice == 'k') {
                selected = 1
                card_to_show = "<img class='card_left' src='" + left_card + "'>" + "<img class='card_right_with_frame' src='" + right_card + "'>" 
            }
            else {
                selected = null
                reward = 0
                return '<div style="font-size:40px;">!אנא הגב מהר יותר</div>'
            }
            return card_to_show 
        }


        function linspace(start, stop, num, endpoint = true) {
            const div = endpoint ? (num - 1) : num;
            const step = (stop - start) / div;
            return Array.from({length: num}, (_, i) => start + step * i)
        }
        

        function practice_show_delay(current_trial_num) {
            card_selected = jsPsych.data.get().filter({ phase: 'practice', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
            card_unselected = jsPsych.data.get().filter({ phase: 'practice', trial_name: 'choice1' }).last(1).select('card_unselected').values[0]

            if (card_selected==undefined){
                delay_prob=0
            }
            else {
                delay_prob = delay_prob_matrix[card_selected][current_trial_num];
            }
    
            random_duration = jsPsych.randomization.sampleWithReplacement(linspace(0,8,40), 1)[0];
            delay_prob_random = delay_prob*random_duration*1000 //converte to ms
            return delay_prob_random
            return random_duration 
            
        }
        
        function show_delay(current_trial_num) {
            card_selected = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
            card_unselected = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'choice1' }).last(1).select('card_unselected').values[0]
            
            if (card_selected==undefined){
                delay_prob=0
            }
            else {
                delay_prob = delay_prob_matrix[card_selected][current_trial_num];
            }
    
            random_duration = jsPsych.randomization.sampleWithReplacement(linspace(0.5,8,40), 1)[0];
            delay_prob_random = delay_prob*random_duration*1000 //converte to ms
            return delay_prob_random
            return random_duration 
            
        }


        function practice_show_reward(current_trial_num) {
            card_selected = jsPsych.data.get().filter({ phase: 'practice', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
            card_unselected = jsPsych.data.get().filter({ phase: 'practice', trial_name: 'choice1' }).last(1).select('card_unselected').values[0]
            key_selected = jsPsych.data.get().filter({ phase: 'practice', trial_name: 'choice1' }).last(1).select('key_selected').values[0]
            if (key_selected == 0) {
                card_to_show = "<img class='card_left_reward' src='" + left_card + "'>"
                card_selected = jsPsych.data.get().filter({ phase: 'practice', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
                prob_chosen = FB_matrix[card_selected][current_trial_num];
                prob_unchosen = FB_matrix[card_unselected][current_trial_num];
                prob_unreward = 1 - prob_chosen;
                reward = jsPsych.randomization.sampleWithReplacement([0, 1], 1, [prob_unreward, prob_chosen])[0];
                reward_to_show = "<img class=reward src='" + reward_images[reward] + "'>"
                
                
            }
            else if (key_selected == 1) {
                card_to_show = "<img class='card_right_reward' src='" + right_card + "'>"
                card_selected = jsPsych.data.get().filter({ phase: 'practice', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
                prob_chosen = FB_matrix[card_selected][current_trial_num];
                prob_unchosen = FB_matrix[card_unselected][current_trial_num];
                prob_unreward = 1 - prob_chosen;
                reward = jsPsych.randomization.sampleWithReplacement([0, 1], 1, [prob_unreward, prob_chosen])[0];
                reward_to_show = "<img class=reward src='" + reward_images[reward] + "'>"

            }
            else {
                prob_chosen = NaN
                prob_unchosen = NaN
                return '<div style="font-size:40px;">!אנא הגב מהר יותר</div>'
            }

            return card_to_show + reward_to_show
        }


        function show_reward(current_trial_num) {
            card_selected = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
            card_unselected = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'choice1' }).last(1).select('card_unselected').values[0]
            key_selected = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'choice1' }).last(1).select('key_selected').values[0]
            if (key_selected == 0) {
                card_to_show = "<img class='card_left_reward' src='" + left_card + "'>"
                card_selected = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
                prob_chosen = FB_matrix[card_selected][current_trial_num];
                prob_unchosen = FB_matrix[card_unselected][current_trial_num];
                prob_unreward = 1 - prob_chosen;
                reward = jsPsych.randomization.sampleWithReplacement([0, 1], 1, [prob_unreward, prob_chosen])[0];
                reward_to_show = "<img class=reward src='" + reward_images[reward] + "'>"
            }
            else if (key_selected == 1) {
                card_to_show = "<img class='card_right_reward' src='" + right_card + "'>"
                card_selected = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'choice1' }).last(1).select('card_selected').values[0]
                prob_chosen = FB_matrix[card_selected][current_trial_num];
                prob_unchosen = FB_matrix[card_unselected][current_trial_num];
                prob_unreward = 1 - prob_chosen;
                reward = jsPsych.randomization.sampleWithReplacement([0, 1], 1, [prob_unreward, prob_chosen])[0];
                reward_to_show = "<img class=reward src='" + reward_images[reward] + "'>"
            }
            else {
                prob_chosen = NaN
                prob_unchosen = NaN
                return '<div style="font-size:40px;">!אנא הגב מהר יותר</div>'
            }
            return card_to_show + reward_to_show
        }

        function images_for_block_start() {
            images = test_deck_images_shuffle[block]
            return images
        }

        /*This function downloads the data */
        var subN = localStorage.subN
        var IDsub = Date.now();
        function download_csv(csv) {
            var hiddenElement = document.createElement('a');
            file_name = "delay" + subN + "_" + IDsub.toString() + ".csv"
            hiddenElement.href = 'data:text/csv;charset=utf-8,' + encodeURI(csv);
            hiddenElement.target = '_blank';
            hiddenElement.download = file_name;
            hiddenElement.click();
        }
        /*---------------------------------------------------- 
        Variabels for card game
        ------------------------------------------------------*/
        var condition_cards = jsPsych.randomization.sampleWithoutReplacement(['1same', '1diff', '4same', '4diff'], 1)[0]
        var FB_matrix = [];

        // random walk: 
        // FB_matrix[1] = [0.33772, 0.39326, 0.40412, 0.45749, 0.48324, 0.48626, 0.45786, 0.42262, 0.49357, 0.50731, 0.54289, 0.53135, 0.50034, 0.49953, 0.48937, 0.50251, 0.53868, 0.52203, 0.49471, 0.45876, 0.52796, 0.50268, 0.46898, 0.4837, 0.47281, 0.48038, 0.42808, 0.39279, 0.37639, 0.36649, 0.35582, 0.35915, 0.38079, 0.37371, 0.37682, 0.41413, 0.39547, 0.44378, 0.46997, 0.47091, 0.50357, 0.53194, 0.51394, 0.52503, 0.53825, 0.54097, 0.49772, 0.50029, 0.48817, 0.50105, 0.45351, 0.46345, 0.50613, 0.51335, 0.56239, 0.56169, 0.56903, 0.5471, 0.50874, 0.53747, 0.50208, 0.51419, 0.53481, 0.47552, 0.48684, 0.51724, 0.49535, 0.51149, 0.53235, 0.4978, 0.47696, 0.47291, 0.48077, 0.4425, 0.48969, 0.52356, 0.54573, 0.49781, 0.52555, 0.50405, 0.519, 0.51776, 0.49547, 0.48375, 0.45753, 0.5155, 0.51645, 0.50343, 0.47022, 0.47794, 0.51657, 0.52218, 0.52722, 0.5297, 0.52667, 0.56737, 0.6445, 0.63256, 0.59317, 0.5313];
        // FB_matrix[2] = [0.25704, 0.25686, 0.26537, 0.32215, 0.2977, 0.31559, 0.29018, 0.24321, 0.24308, 0.27374, 0.28045, 0.31219, 0.3303, 0.30804, 0.37726, 0.40205, 0.37142, 0.34159, 0.31001, 0.30259, 0.25156, 0.28041, 0.29775, 0.33556, 0.33383, 0.27651, 0.31895, 0.3416, 0.31953, 0.27126, 0.28677, 0.27745, 0.23634, 0.18869, 0.1756, 0.16868, 0.16833, 0.16272, 0.16272, 0.16828, 0.23888, 0.215, 0.2362, 0.2198, 0.25504, 0.24835, 0.23921, 0.25358, 0.28813, 0.29193, 0.30125, 0.26231, 0.25296, 0.28666, 0.26313, 0.2301, 0.21956, 0.20996, 0.25839, 0.28052, 0.32197, 0.35135, 0.36251, 0.35102, 0.37592, 0.41482, 0.46239, 0.46043, 0.50986, 0.56564, 0.59565, 0.62044, 0.56731, 0.55831, 0.58139, 0.58884, 0.54916, 0.5071, 0.51807, 0.54408, 0.56728, 0.52195, 0.55915, 0.53774, 0.53981, 0.52355, 0.46647, 0.4676, 0.45075, 0.48408, 0.55282, 0.54373, 0.53274, 0.53184, 0.53568, 0.49976, 0.50574, 0.552, 0.51679, 0.53681];
        // FB_matrix[3] = [0.5917, 0.64769, 0.70574, 0.68713, 0.68242, 0.70379, 0.71255, 0.70272, 0.67069, 0.65692, 0.65933, 0.64338, 0.65085, 0.64829, 0.69846, 0.71015, 0.70442, 0.74258, 0.7554, 0.73006, 0.75518, 0.72853, 0.74084, 0.68069, 0.71271, 0.68525, 0.67073, 0.67068, 0.648, 0.67646, 0.70308, 0.68574, 0.71904, 0.71133, 0.73911, 0.74918, 0.73149, 0.70956, 0.68745, 0.69793, 0.6233, 0.62599, 0.66243, 0.69599, 0.68707, 0.649, 0.60675, 0.59887, 0.63346, 0.69691, 0.66782, 0.69997, 0.72736, 0.70792, 0.67461, 0.6478, 0.65467, 0.6329, 0.6158, 0.60556, 0.64038, 0.63054, 0.58793, 0.56423, 0.55994, 0.56647, 0.54658, 0.49899, 0.50783, 0.57898, 0.54492, 0.48585, 0.48109, 0.48699, 0.46963, 0.48634, 0.46603, 0.47676, 0.45376, 0.40843, 0.39107, 0.40562, 0.35266, 0.33274, 0.31999, 0.34656, 0.37718, 0.37391, 0.38179, 0.40437, 0.4088, 0.33946, 0.33295, 0.31311, 0.32477, 0.37747, 0.36431, 0.35193, 0.33457, 0.32013];
        // FB_matrix[4] = [0.37146, 0.29856, 0.30642, 0.2707, 0.25356, 0.25763, 0.1921, 0.20666, 0.19305, 0.19291, 0.18298, 0.18156, 0.19481, 0.15628, 0.18232, 0.21027, 0.20945, 0.22949, 0.20882, 0.23431, 0.24699, 0.19052, 0.2206, 0.21146, 0.19117, 0.21937, 0.23521, 0.27283, 0.33207, 0.33282, 0.3137, 0.32797, 0.33243, 0.33035, 0.37739, 0.38959, 0.39165, 0.43298, 0.4753, 0.45643, 0.46237, 0.46749, 0.47418, 0.47148, 0.46565, 0.48012, 0.51917, 0.56677, 0.551, 0.52118, 0.5035, 0.51614, 0.48258, 0.4852, 0.51321, 0.5236, 0.54053, 0.58072, 0.58066, 0.60732, 0.60788, 0.62424, 0.61417, 0.61129, 0.61249, 0.63833, 0.6153, 0.64763, 0.66878, 0.65734, 0.66195, 0.66565, 0.68452, 0.66885, 0.6788, 0.69809, 0.6875, 0.69827, 0.6978, 0.72358, 0.7295, 0.74277, 0.73044, 0.74494, 0.74108, 0.74222, 0.74686, 0.80182, 0.80182, 0.82339, 0.81468, 0.81121, 0.84829, 0.83158, 0.83158, 0.80201, 0.74137, 0.72785, 0.73865, 0.76278];

        //note: different probabilities for each flower (card)
        
        FB_matrix[1]=[0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35, 0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35,	0.35];
        FB_matrix[2]=[0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45, 0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45,	0.45];
        FB_matrix[3]=[0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55, 0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55,	0.55 ];
        FB_matrix[4]=[0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65, 0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65,	0.65];

        var delay_prob_matrix = [];
        delay_prob_matrix[1]=[1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1];
        delay_prob_matrix[2]=[1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1];
        delay_prob_matrix[3]=[1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1];
        delay_prob_matrix[4]=[1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1, 1, 1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1,	1];




        var current_cards_practice_trial = 0;
        var current_cards_exp_trial = 0;
        var block = 0;
        var blocks = 7;
        var draw_cards;
        var drawn_cards;
        var left_card;
        var right_card;
        var selected;
        var reward;
        var delay_prob;
        var random_duration;
        var delay_prob_random;
        var card_selected;
        var key_selected;
        var test_procedure_cards;
        var phase;
    

        /*---------------------------------------------------- 
        Start practice
        ------------------------------------------------------*/
        var timeline = [];

        var start_practice_only_cards = {
            type: 'html-keyboard-response',
            stimulus: '<div>.כעת נעבור לשלב האימון<br>  .<b>"k"</b> - ו <b>"s"</b> אנא תהיה מוכן עם האצבעות על המיקומים במקלדת  <br><br> <b>לחץ על מקש כלשהו על מנת להתחיל</b></div>',
            post_trial_gap: 1000,
            on_finish: function () { document.querySelector('head').insertAdjacentHTML('beforeend', '<style id="cursor-toggle"> html { cursor: none; } </style>') },
        }


        var start_practice_only_cards_block2 = {
            type: 'html-keyboard-response',
            stimulus: '<div>.כעת נעבור לשלב השני של האימון<br>  .<b>"k"</b> - ו <b>"s"</b> אנא תהיה מוכן עם האצבעות על המיקומים במקלדת  <br><br> <b>לחץ על מקש כלשהו על מנת להתחיל</b></div>',
            post_trial_gap: 1000,
            on_finish: function () { document.querySelector('head').insertAdjacentHTML('beforeend', '<style id="cursor-toggle"> html { cursor: none; } </style>') },
        }

        var start_practice_cards = {
            type: 'html-keyboard-response',
            stimulus: '<div>We will now start a few practice trials with both the cards and the squares. <br> Please be ready with your fingers on <b>"s"</b> and <b>"k"</b> <br><br> <b> Press any key to begin</b></div>',
            post_trial_gap: 1000,
        }

        var fixation_cards = {
            type: 'html-keyboard-response',
            stimulus: fixation,
            choices: jsPsych.NO_KEYS,
            trial_duration: 1000
        }

        
        var practice_cards = {
            type: "html-keyboard-response",
            stimulus: function () {
                return draw_show_cards(practice_deck_images)
            },
            choices: ['s', 'k'],
            trial_duration: 6000,
            data: { phase: 'practice', trial_name: 'cards1', trial_num: function () { return current_cards_practice_trial }, block: function () { return block }, },

        }



        var practice_cards_iti = {
            type: "html-keyboard-response",
            stimulus: function () {
                return draw_show_cards(practice_deck_images_iti)
            },
            choices: ['s', 'k'],
            trial_duration: 6000,
            data: { phase: 'practice', trial_name: 'cards1', trial_num: function () { return current_cards_practice_trial }, block: function () { return block }, },

        }

        var practice_choice = {
            type: "html-keyboard-response",
            stimulus: show_choice,
            choices: jsPsych.NO_KEYS,
            trial_duration: 500,
            data: { phase: 'practice', trial_name: 'choice1', trial_num: function () { return current_cards_practice_trial } , block: function () { return block },},
            on_finish: function (data) {
                data.key_selected = selected
                if (selected == 0) {
                    data.card_selected = practice_deck_images.indexOf(left_card) +1 
                    data.card_unselected = practice_deck_images.indexOf(right_card) +1 
                }
                else if (selected == 1) {
                    data.card_selected = practice_deck_images.indexOf(right_card) +1
                    data.card_unselected = practice_deck_images.indexOf(left_card) +1
                }
            }
        }
 


        var practice_choice_iti = {
            type: "html-keyboard-response",
            stimulus: show_choice,
            choices: jsPsych.NO_KEYS,
            trial_duration: 500,
            data: { phase: 'practice', trial_name: 'choice1', trial_num: function () { return current_cards_practice_trial } , block: function () { return block },},
            on_finish: function (data) {
                data.key_selected = selected
                if (selected == 0) {
                    data.card_selected = practice_deck_images_iti.indexOf(left_card) +1 
                    data.card_unselected = practice_deck_images_iti.indexOf(right_card) +1 
                }
                else if (selected == 1) {
                    data.card_selected = practice_deck_images_iti.indexOf(right_card) +1
                    data.card_unselected = practice_deck_images_iti.indexOf(left_card) +1
                }
            }
        }


        var practice_delay ={
            type: 'image-keyboard-response',
            stimulus:  Hourglass ,
            choices: jsPsych.NO_KEYS,
            trial_duration: function () {
                 return practice_show_delay(current_cards_practice_trial)
             },
            post_trial_gap: 0,
            css_classes: ['stimulus'],
            data: {
                phase: 'practice', trial_name: 'practice_delay', trial_num: function () { return current_cards_practice_trial }, block: function () { return block }, 
            },
        }   

        

        var practice_reward = {
            type: "html-keyboard-response",
            stimulus: function () {
                return practice_show_reward(current_cards_practice_trial)
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 2000,
            data: { phase: 'practice', trial_name: 'reward1', trial_num: function () { return current_cards_practice_trial } ,block: function () { return block }, iti_delay: 0
        }, on_finish: function (data) {
                data.reward = reward;
                data.delay_prob = delay_prob;
                data.random_duration = random_duration;
                data.delay= delay_prob_random;
                data.prob_chosen=prob_chosen;
                data.prob_unchosen = prob_unchosen;
                data.int_trial_number = current_cards_practice_trial;
                data. prob_flower1 = FB_matrix[1][current_cards_practice_trial];
                data. prob_flower2 = FB_matrix[2][current_cards_practice_trial];
                data. prob_flower3 = FB_matrix[3][current_cards_practice_trial];
                data. prob_flower4 = FB_matrix[4][current_cards_practice_trial];
                data.subject_num = subject_num;
                data.left_image= left_card[29];
                data.right_image= right_card[29];
                data.flower_set= 1; 
                current_cards_practice_trial += 1;
                

                
            }
        }
        


        var practice_reward_iti = {
            type: "html-keyboard-response",
            stimulus: function () {
                return practice_show_reward(current_cards_practice_trial)
            },
            choices: jsPsych.NO_KEYS,
            trial_duration: 2000,
            data: { 
                phase: 'practice', trial_name: 'reward1', trial_num: function () { return current_cards_practice_trial } ,block: function () { return block }, iti_delay: 1
            },

            on_finish: function (data) {
                data.reward = reward;
                data.delay_prob = delay_prob;
                data.random_duration = random_duration;
                data.delay= delay_prob_random;
                data.prob_chosen=prob_chosen;
                data.prob_unchosen = prob_unchosen;
                data.int_trial_number = current_cards_practice_trial;
                data. prob_flower1 = FB_matrix[1][current_cards_practice_trial];
                data. prob_flower2 = FB_matrix[2][current_cards_practice_trial];
                data. prob_flower3 = FB_matrix[3][current_cards_practice_trial];
                data. prob_flower4 = FB_matrix[4][current_cards_practice_trial];
                data.subject_num = subject_num;
                data.left_image= left_card[29];
                data.right_image= right_card[29];
                data.flower_set= 1; 
                current_cards_practice_trial += 1;
                

                
            }
        }
        

        

        /*---------------------------------------------------- 
        Start exp part of card game
        ------------------------------------------------------*/

        var start_exp_cards = {
            on_start: function() {$('body').css('cursor', 'none')},
            type: 'html-keyboard-response',
            stimulus: '<div> .עבודה טובה! שלב האימון הסתיים <br> <br> !כעת נעבור למשחק האמיתי. עשה כמיטב יכולתך על מנת להבין אילו פרחים טובים יותר מאחרים. בהצלחה<br><br> <b>לחץ על מקש כלשהו על מנת להמשיך</b></div>',
            post_trial_gap: 1000
        }

        var start_block = {
            type: 'html-keyboard-response',
            stimulus: function () {
                return '<p><b><u>בלוק מספר ' + (block + 1) + ' מתוך ' + (blocks + 1) + '</u></b></p>' + '<p style="text-align: right"> .אתה תתחיל כעת בלוק חדש. להלן ארבעת הפרחים שיכולים להופיע בבלוק זה</p>'
                    + '<p style="text-align: right"> .(בהתאמה s או k) השתמש במקש הימני או השמאלי על מנת לבצע את הבחירה שלך <br>!בצע כמיטב יכולת על מנת לזכות בכמה שיותר מטבעות<br> </p>'
                    + '<p style="text-align: right">.זכור שרק הפרחים עצמם משפיעים על הזכייה במטבעות (ולא המקשים על המקלדת או זמן ההמתנה) </p>'
                    + '<p><b>לחץ על מקש הרווח כדי להתחיל</b></p>'
                    + '<img src="' + images_for_block_start()[0] + '">  ' + '<img src="' + images_for_block_start()[1] + '">    ' + '<img src="' + images_for_block_start()[2]
                    + '">    ' + '<img src="' + images_for_block_start()[3] + '">  '
            },
            choices: [32]
            , post_trial_gap: 1000
        }

    
        var exp_cards = {
            type: "html-keyboard-response",
            stimulus: function () {
                return draw_show_cards(images_for_block_start())
            },
            choices: ['s', 'k'],
            trial_duration: 6000,
            response_ends_trial: true,
            data: { phase: 'exp', trial_name: 'cards1', trial_num: function () { return current_cards_exp_trial } ,block: function () { return block }},

        }

        var exp_choice = {
            type: "html-keyboard-response",
            stimulus: show_choice,
            choices: jsPsych.NO_KEYS,
            trial_duration: 500,
            data: { phase: 'exp', trial_name: 'choice1', trial_num: function () { return current_cards_exp_trial } ,block: function () { return block }}, 
            on_finish: function (data) {
                data.key_selected = selected
                if (selected == 0) {
                    data.card_selected = images_for_block_start().indexOf(left_card) +1 
                    data.card_unselected = images_for_block_start().indexOf(right_card) +1 
                }
                else if (selected == 1) {
                    data.card_selected = images_for_block_start().indexOf(right_card) +1 
                    data.card_unselected = images_for_block_start().indexOf(left_card) +1 
                }
            
            }
        }
        var exp_delay ={
            type: 'image-keyboard-response',
            stimulus: Hourglass ,
            choices: jsPsych.NO_KEYS,
            trial_duration: function () {
                 return show_delay(current_cards_exp_trial)
             },
            post_trial_gap: 0,
            css_classes: ['stimulus'],
            data: {
                phase: 'exp', trial_name: 'exp_delay', trial_num: function () { return current_cards_exp_trial }, block: function () { return block }
            },
        }


        var exp_reward = {
            type: "html-keyboard-response",
            stimulus: function () {
                return show_reward(current_cards_exp_trial)
            },
            choices: [' '],
            trial_duration: 2000,
            data: {
                phase: 'exp', trial_name: 'reward1', trial_num: function () { return current_cards_exp_trial }, block: function () { return block }, iti_delay: 0
            },

            on_finish: function (data) {
                data.reward = reward;
                data.delay_prob = delay_prob;
                data.random_duration = random_duration;
                data.delay= delay_prob_random;
                data.prob_chosen=prob_chosen;
                data.prob_unchosen = prob_unchosen;
                data.int_trial_number = current_cards_practice_trial;
                data. prob_flower1 = FB_matrix[1][current_cards_practice_trial];
                data. prob_flower2 = FB_matrix[2][current_cards_practice_trial];
                data. prob_flower3 = FB_matrix[3][current_cards_practice_trial];
                data. prob_flower4 = FB_matrix[4][current_cards_practice_trial];
                data.subject_num = subject_num;
                data.left_image= left_card[21];
                data.right_image= right_card[21];
                data.flower_set= images[0][19]; 
                current_cards_exp_trial += 1;

            }
         }



        var exp_reward_iti = {
            type: "html-keyboard-response",
            stimulus: function () {
                return show_reward(current_cards_exp_trial)
            },
            choices: [' '],
            trial_duration: 2000,
            data: {
                phase: 'exp', trial_name: 'reward1', trial_num: function () { return current_cards_exp_trial }, block: function () { return block }, iti_delay: 1
            },

            on_finish: function (data) {
                data.reward = reward;
                data.delay_prob = delay_prob;
                data.random_duration = random_duration;
                data.delay= delay_prob_random;
                data.prob_chosen=prob_chosen;
                data.prob_unchosen = prob_unchosen;
                data.int_trial_number = current_cards_practice_trial;
                data. prob_flower1 = FB_matrix[1][current_cards_practice_trial];
                data. prob_flower2 = FB_matrix[2][current_cards_practice_trial];
                data. prob_flower3 = FB_matrix[3][current_cards_practice_trial];
                data. prob_flower4 = FB_matrix[4][current_cards_practice_trial];
                data.subject_num = subject_num;
                data.left_image= left_card[21];
                data.right_image= right_card[21];
                data.flower_set= images[0][19]; 
                current_cards_exp_trial += 1;

            }
         }


        var finish_block = {
            type: 'html-keyboard-response',
            stimulus: function () {
                finish_block_string = '<p>!כל הכבוד</p>' 
                + '<p style="text-align: left"> <br> . בלוק מספר' +' '+ (block + 1) + ' מתוך ' + (blocks + 1) + ' הסתיים ' +'.'
                if (block != '7') {
                    finish_block_string += 'אתה יכול להתמתח קצת ולקחת הפסקה קצרה בזמן שאתה יושב בכיסא</p><p> <br><br><br><b>לחץ על מקש הרווח על מנת להמשיך</b>  </p>'
                    number_of_coins = ' '
                    //bonus = ' '
                }
                else {
                    number_of_reward1 = jsPsych.data.get().filter({ phase: 'exp', trial_name: 'reward1' }).select('reward').sum()
                    number_of_coins = 'אספת' +' '+ number_of_reward1 +' ' + 'מטבעות'

                    finish_block_string += 'כעת נמשיך למענה על מספר שאלות</p><p> <br><br><br><b>אנא קרא לנסיין</b>  </p>'

                    // if (number_of_reward1 > 100){
                    //     // bonus = '<p> <br><br><br><b>הבונוס שלך הוא 5 שקלים</b>  </p>'
                    //  }
                    // else {
                    //     bonus = ' '
                    // }
                    
                 }
                 return number_of_coins + finish_block_string 
                // return finish_block_string + bonus + number_of_coins
            },
            post_trial_gap: 1000,
            choices: [32],
            on_finish: function () {
                block += 1;
                //current_cards_exp_trial = 0;
            }
        }
    
        /*---------------------------------------------------- 
        Define timeline for card part
        ------------------------------------------------------*/

        var demo_procedure_only_cards = {
            timeline: [fixation_cards, practice_cards, practice_choice,practice_delay,practice_reward],
            repetitions: 6
        }

        var demo_procedure_only_cards_iti = {
            timeline: [fixation_cards, practice_cards_iti, practice_choice_iti, practice_reward_iti,practice_delay],
            repetitions: 6
        }

        var instructions_loop = {
            timeline: [instructions_cards , start_instructions_test, instructions_test, check_answers],
            loop_function: function () {
                if (to_repeat == true) {
                    return true;
                } else {
                    return false;
                }
            }
        }

        var instructions_demo = {
            timeline: [start_practice_only_cards, demo_procedure_only_cards],
            repetitions: 1
        }

        // var instructions_demo = {
        //     timeline: [start_practice_only_cards, demo_procedure_only_cards_iti],
        //     repetitions: 1
        // }

        var instructions_demo_iti = {
            timeline: [start_practice_only_cards_block2, demo_procedure_only_cards_iti],
            repetitions: 1
        }

        // var instructions_demo_iti = {
        //     timeline: [start_practice_only_cards_block2, demo_procedure_only_cards],
        //     repetitions: 1
        // }


        var test_procedure_cards = {
            timeline: [fixation_cards, exp_cards, exp_choice, exp_delay,exp_reward],
            repetitions: 25
        }


        var test_procedure_cards_iti = {
            timeline: [fixation_cards, exp_cards, exp_choice, exp_reward_iti, exp_delay],
            repetitions: 25
        }

        var test_blocks = {
            timeline: [start_block, test_procedure_cards, finish_block],
            repetitions: 1
        };


        var test_blocks_iti = {
            timeline: [start_block, test_procedure_cards_iti, finish_block],
            repetitions: 1
        };


        var blocks_iti_1 = {
            timeline: [test_blocks, test_blocks_iti],
            repetitions: 4
        };

        var blocks_iti_2 = {
            timeline: [test_blocks_iti, test_blocks],
            repetitions: 4
        };

        var full_procedure_cards = {
            timeline: [subject_num,instructions_loop, instructions_demo,instructions_demo_iti,start_exp_cards, blocks_iti_1],
            //timeline: [subject_num,instructions_loop, instructions_demo,instructions_demo_iti,start_exp_cards, blocks_iti_2],
            // timeline: [blocks_iti_1],
            repetitions: 1
        };



    // var procedure_cards = function() {
    //     var i=jsPsych.randomization.sampleWithReplacement([1,2], 1);
    //     if (i<2) {
    //         var full_procedure_cards = {timeline: [subject_num,instructions_loop, instructions_demo,start_exp_cards, blocks_iti_1]}
    //     }
         
    //     else {
    //         var full_procedure_cards = {timeline: [subject_num,instructions_loop, instructions_demo_iti,start_exp_cards, blocks_iti_2]}
    //     }

    //     return full_procedure_cards

    //         };

              
    //timeline: [subject_num,instructions_loop, instructions_demo_iti,start_exp_cards, blocks_iti_2]
        //instructions+test takes 180sec 
        
        
        timeline.push({
                type: 'fullscreen',
                fullscreen_mode: true,
                message: '<p style="text-align: center">לאחר לחיצת על המקש מטה תעבור לתצוגת מסך מלא</p>',
                button_label: 'המשך לתצוגת מסך מלא'
            });
        // var full_procedure_cards = procedure_cards();
        timeline.push(full_procedure_cards);
        
    



        /*---------------------------------------------------- 
              Define init for the whole experiment
              ------------------------------------------------------*/
        jsPsych.init({
            timeline: timeline,
            preload_images: practice_deck_images, test_deck_images, reward_images, practice_deck_images_iti, reward_images, Hourglass, garden, cute_gardener, 
            show_preload_progress_bar: true,
            on_finish: function () {
                        var data = jsPsych.data.get();
                        data.localSave('json','flowers.json');
                        //data.localSave(data.json());
                        // data.localSave('csv','flowers.csv');
                        //jsPsych.data.displayData();
                        /*get data */
                        processed_data = data.json()
                        window.parent.postMessage({ id: 'embeddedDataId', answer: processed_data }, '*');	


                            // $.ajax({
                            //     type: 'POST',
                            //     url: '/save',
                            //     data: { 'data': processed_data},
                            //     success: function () {
                            //         console.log('success');
                            //         document.location = '/next'
                            //     },
                            //     // Endpoint not running, local save
                            //     error: function (err) {
                            //         console.log(err)
                            //     }
                            //  });
                     }

        });


</script>
</body>
</html>

